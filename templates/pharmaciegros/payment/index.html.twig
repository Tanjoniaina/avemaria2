{% extends 'base.html.twig' %}

{% block title %}Payment index{% endblock %}

{% block body %}
    <h3>Paiement en attente</h3>
    <table class="table table-striped table-bordered datatable">
        <thead>
        <tr>
            <th>Facture</th>
            <th>Fournisseur</th>
            <th>Duedate</th>
            <th>Reste</th>
            <th>Montant</th>
            <th>Reste à payer</th>
            <th>Indicateur</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        {% for facture in facture %}
            {% set seconds = (facture.duedate|date('U')) - ("now"|date('U')) %}
            {% set days = (seconds / 86400)|round(0, 'ceil') %}
            <tr>
                <td>{{ facture.invoicenumber }}</td>
                <td>{{ facture.supplier.name }}</td>
                <td>{{ facture.duedate|date('Y-m-d') }}</td>

                <td>{{ days }} jour{{ days|abs > 1 ? 's' : '' }}</td>
                <td>{{ facture.amount }}</td>
                <td>{{ facture.resteAPayer }}</td>
                <td>
                    {% if days >= 30 %}
                        <span class="text-success">
                            <i class="bi bi-check-circle" title="Plus de 30 jours restants" aria-label="Plus de 30 jours"></i> À jour
                        </span>
                    {% elseif days >= 7 %}
                        <span class="text-warning">
                            <i class="bi bi-exclamation-triangle " title="Entre 7 et 29 jours restants" aria-label="Entre 7 et 29 jours"></i> Bientôt dû
                        </span>
                    {% else %}
                        <span class="text-danger">
                            <i class="bi bi-x-circle " title="Moins de 7 jours restants" aria-label="Moins de 7 jours"></i> Urgent
                        </span>
                    {% endif %}
                </td>
                <td>
                    <a href="{{ path('app_pharmaciegros_entity_payment_new', {'invoice': facture.id}) }}">Payer</a>
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="6">no records found</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <br><br>
    <h3>Historique de paiement</h3>
    <table class="table">
        <thead>
            <tr>
                <th>Id</th>
                <th>Payementdate</th>
                <th>Amount</th>
                <th>Payementmethod</th>
                <th>Facture</th>
                <th>actions</th>
            </tr>
        </thead>
        <tbody>
        {% for payment in payments %}
            <tr>
                <td>{{ payment.id }}</td>
                <td>{{ payment.payementdate ? payment.payementdate|date('Y-m-d H:i:s') : '' }}</td>
                <td>{{ payment.amount }}</td>
                <td>{{ payment.payementmethod }}</td>
                <td>{{ payment.invoice.invoicenumber }}</td>
                <td>
                    <a href="{{ path('app_pharmaciegros_entity_payment_show', {'id': payment.id}) }}">show</a>
                    <a href="{{ path('app_pharmaciegros_entity_payment_edit', {'id': payment.id}) }}">edit</a>
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="6">no records found</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            initDataTables();
        });
    </script>
{% endblock %}